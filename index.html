<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>20nagar Food Xpress</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--brand:#ff9933}
body{margin:0;font-family:Arial,sans-serif;background:#f7f7f7}
.page{display:none;min-height:100vh;background:#fff}
.page.active{display:block}

.header{
  padding:10px;
  border-bottom:1px solid #ddd;
  text-align:center;
}
.header img{height:42px}

.topbar{padding:12px;border-bottom:1px solid #ddd;cursor:pointer}
.content{padding:14px;padding-bottom:90px}

.search{width:100%;padding:10px;margin:10px 0}

.restaurant{
  display:flex;gap:12px;align-items:center;
  padding:12px;border:1px solid #ddd;margin-bottom:10px
}
.restaurant.open{cursor:pointer}
.restaurant.closed{opacity:.6}

.restaurant img{
  width:48px;height:48px;border-radius:6px;object-fit:cover
}
.rest-info{flex:1}
.rest-name{font-weight:600}
.rest-status{font-size:12px;margin-top:4px}
.open-text{color:green}
.closed-text{color:red}

.category{font-weight:bold;font-size:18px;margin-top:20px}

.item,.cart-item{
  display:flex;justify-content:space-between;align-items:flex-start;
  padding:10px 0;border-bottom:1px solid #eee
}
.item-name{font-weight:600}
.item-desc{font-size:13px;color:#777;margin-top:2px}

.qty{display:flex;align-items:center;gap:8px}
.qty button{
  width:28px;height:28px;border:none;
  background:var(--brand);color:#fff;font-size:18px
}

.cart-bar{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--brand);color:#fff;
  padding:12px;display:none;
  justify-content:space-between;cursor:pointer
}

.bill div{display:flex;justify-content:space-between;margin-bottom:6px}
.bill .total{font-weight:bold;font-size:18px}
.note{font-size:12px;color:#666;margin-top:8px}

button.primary{
  width:100%;padding:12px;background:var(--brand);
  color:#fff;border:none;font-size:16px;margin-top:16px
}

.cat-btn{
  position:fixed;right:16px;bottom:80px;
  background:#333;color:#fff;
  padding:10px 14px;border-radius:20px;font-size:14px;cursor:pointer
}

.cat-popup{
  position:fixed;inset:0;background:rgba(0,0,0,.4);display:none
}
.cat-box{
  background:#fff;margin:20% auto;width:80%;
  border-radius:8px;padding:10px
}
.cat-box div{padding:10px;border-bottom:1px solid #eee;cursor:pointer}

input,textarea{
  width:100%;padding:10px;margin-top:6px;font-size:16px
}
.small{font-size:12px;color:#666}
</style>
</head>
<body>

<!-- PAGE 1: RESTAURANTS -->
<div id="page-restaurants" class="page active">
  <div class="header">
    <img src="company-logo.png">
  </div>
  <div class="content">
    <input class="search" placeholder="Search restaurant..." oninput="filterRestaurants(this.value)">
    <div id="restaurantList"></div>
  </div>
</div>

<!-- PAGE 2: MENU -->
<div id="page-menu" class="page">
  <div class="topbar" onclick="backToRestaurants()">← Back</div>
  <div class="header"><img src="company-logo.png"></div>
  <div class="content">
    <h2 id="menuTitle"></h2>
    <div id="menuItems"></div>
  </div>
  <div class="cat-btn" onclick="openCats()">☰ Categories</div>
</div>

<div id="catPopup" class="cat-popup" onclick="closeCats()">
  <div class="cat-box" onclick="event.stopPropagation()" id="catList"></div>
</div>

<!-- PAGE 3: ORDER SUMMARY -->
<div id="page-summary" class="page">
  <div class="topbar" onclick="goBack()">← Back</div>
  <div class="header"><img src="company-logo.png"></div>
  <div class="content">
    <h2>Order Summary</h2>
    <div id="summaryItems"></div>

    <div class="bill">
      <div><span>Item Total</span><span id="itemTotal">₹0</span></div>
      <div><span>Delivery Charge</span><span id="deliveryCharge">₹0</span></div>
      <div class="total"><span>Total Payable</span><span id="grandTotal">₹0</span></div>
    </div>

    <div class="note">
      Delivery charges shown are applicable up to 2.5 km.
      Charges may vary for longer distances.
    </div>

    <button class="primary" onclick="goToAddress()">Continue → Address</button>
  </div>
</div>

<!-- PAGE 4: ADDRESS -->
<div id="page-address" class="page">
  <div class="topbar" onclick="goBack()">← Back</div>
  <div class="header"><img src="company-logo.png"></div>
  <div class="content">
    <h2>Delivery Details</h2>
    <label>Name</label><input id="custName">
    <label>Phone</label><input id="custPhone">
    <label>Address</label><textarea id="custAddress"></textarea>
    <button class="primary" onclick="captureLocation()">Use my current location</button>
    <p id="locStatus" class="small"></p>
    <button class="primary" onclick="placeOrder()">Place Order</button>
  </div>
</div>

<div id="cartBar" class="cart-bar" onclick="openSummary()">
  <span id="cartInfo"></span><span>View Order →</span>
</div>

<script>
/* ================= DATA ================= */
const restaurants=[
 {name:"Hotel Anand",logo:"restaurant-logo.png",slots:[["00:15","14:00"],["18:00","23:00"]]},
 {name:"Shree Krishna Dhaba",logo:"restaurant-logo.png",slots:[["10:00","22:30"]]}
];

const menus={
 "Hotel Anand":{
  Veg:[{n:"Paneer Butter Masala",p:180,d:"Rich tomato gravy"}],
  "Non-Veg":[{n:"Chicken Biryani",p:220,d:"Slow cooked rice"}]
 },
 "Shree Krishna Dhaba":{
  Veg:[{n:"Veg Kolhapuri",p:160}],
  "Non-Veg":[{n:"Chicken Curry",p:200,d:"Traditional spicy gravy"}]
 }
};

let cart={},currentRestaurant="",stack=["page-restaurants"];
let lat="",lng="",mapLink="";

/* ================= TIME ================= */
function toMin(t){const[a,b]=t.split(":").map(Number);return a*60+b}
function nowMin(){const d=new Date();return d.getHours()*60+d.getMinutes()}
function status(r){
 const n=nowMin();
 for(const s of r.slots){
  if(n>=toMin(s[0])&&n<=toMin(s[1]))return{open:true,closes:s[1]};
  if(n<toMin(s[0]))return{open:false,opens:s[0]};
 }
 return{open:false,opens:r.slots[0][0]};
}

/* ================= DELIVERY ================= */
function delivery(t){
 if(t<=0)return 0;
 if(t>=1199)return 1;
 if(t>=999)return 9;
 if(t>=799)return 19;
 if(t>=599)return 29;
 if(t>=399)return 39;
 return 49;
}

/* ================= NAV ================= */
function show(p){
 document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
 document.getElementById(p).classList.add("active")
}
function nav(p){stack.push(p);show(p)}
function goBack(){stack.pop();show(stack[stack.length-1])}
function backToRestaurants(){cart={};updateBar();stack=["page-restaurants"];show("page-restaurants")}

/* ================= RESTAURANTS ================= */
function renderRestaurants(){
 restaurantList.innerHTML="";
 const open=[],closed=[];
 restaurants.forEach(r=>{
  const s=status(r);
  const d=document.createElement("div");
  d.className="restaurant "+(s.open?"open":"closed");
  d.innerHTML=`
   <img src="${r.logo}">
   <div class="rest-info">
    <div class="rest-name">${r.name}</div>
    <div class="rest-status ${s.open?"open-text":"closed-text"}">
     ${s.open?"Open • Closes at "+s.closes:"Closed • Opens at "+s.opens}
    </div>
   </div>`;
  if(s.open)d.onclick=()=>openMenu(r.name);
  (s.open?open:closed).push(d);
 });
 [...open,...closed].forEach(x=>restaurantList.appendChild(x))
}
setInterval(renderRestaurants,60000);

function filterRestaurants(q){
 q=q.toLowerCase();
 document.querySelectorAll(".restaurant").forEach(r=>{
  r.style.display=r.innerText.toLowerCase().includes(q)?"":"none"
 })
}

/* ================= MENU ================= */
function openMenu(n){
 cart={};currentRestaurant=n;menuTitle.innerText=n;
 renderMenu();nav("page-menu")
}
function renderMenu(){
 menuItems.innerHTML="";catList.innerHTML="";
 const m=menus[currentRestaurant];
 for(const c in m){
  menuItems.innerHTML+=`<div class="category" id="cat-${c}">${c}</div>`;
  catList.innerHTML+=`<div onclick="scrollCat('${c}')">${c}</div>`;
  m[c].forEach(i=>{
   const q=cart[i.n]||0;
   menuItems.innerHTML+=`
   <div class="item">
    <div>
     <div class="item-name">${i.n}</div>
     ${i.d?`<div class="item-desc">${i.d}</div>`:""}
     <div class="small">₹${i.p}</div>
    </div>
    <div class="qty">
     <button onclick="upd('${i.n}',${i.p},-1)">−</button>
     <span>${q}</span>
     <button onclick="upd('${i.n}',${i.p},1)">+</button>
    </div>
   </div>`;
  })
 }
 updateBar()
}

  /* ================= CATEGORY SCROLL ================= */
function openCats(){
 document.getElementById("catPopup").style.display="block";
}

function closeCats(){
 document.getElementById("catPopup").style.display="none";
}

function scrollCat(c){
 const el=document.getElementById("cat-"+c);
 if(el) el.scrollIntoView({behavior:"smooth"});
 closeCats();
}

/* ================= CART ================= */
function upd(n,p,d){
 cart[n]=(cart[n]||0)+d;
 if(cart[n]<=0)delete cart[n];
 if(stack.at(-1)==="page-menu")renderMenu();
 if(stack.at(-1)==="page-summary")renderSummary();
}
function price(n){
 return Object.values(menus[currentRestaurant]).flat().find(x=>x.n===n).p
}
function updateBar(){
 let it=0,t=0;
 for(const i in cart){it+=cart[i];t+=cart[i]*price(i)}
 if(it>0&&stack.at(-1)==="page-menu"){
  cartBar.style.display="flex";
  cartInfo.innerText=`${it} items | ₹${t}`
 }else cartBar.style.display="none"
}
function openSummary(){renderSummary();nav("page-summary")}
function renderSummary(){
 summaryItems.innerHTML="";
 let t=0;
 for(const i in cart){
  const p=price(i);t+=cart[i]*p;
  summaryItems.innerHTML+=`
   <div class="cart-item">
    <div>${i}<div class="small">₹${p}</div></div>
    <div class="qty">
     <button onclick="upd('${i}',${p},-1)">−</button>
     <span>${cart[i]}</span>
     <button onclick="upd('${i}',${p},1)">+</button>
    </div>
   </div>`;
 }
 const d=delivery(t);
 itemTotal.innerText=`₹${t}`;
 deliveryCharge.innerText=`₹${d}`;
 grandTotal.innerText=`₹${t+d}`;
}

/* ================= ADDRESS ================= */
function goToAddress(){
 let t=0;for(const i in cart)t+=cart[i]*price(i);
 if(t===0){alert("Please add items");return}
 if(t<99){alert("Minimum order ₹99");return}
 nav("page-address")
}
function captureLocation(){
 navigator.geolocation.getCurrentPosition(p=>{
  lat=p.coords.latitude;lng=p.coords.longitude;
  mapLink=`https://www.google.com/maps?q=${lat},${lng}`;
  locStatus.innerText="Location captured ✓"
 },()=>alert("Location required"))
}

/* ================= PLACE ORDER ================= */
function placeOrder(){
 let t=0;for(const i in cart)t+=cart[i]*price(i);
 if(t<99){alert("Minimum order ₹99");return}
 const n=custName.value.trim();
 if(!/^[A-Za-z ]{5,25}$/.test(n)){alert("Please enter your full name (only letters, 5–25 characters)");return}
 const ph=custPhone.value.trim();
 if(!/^[0-9]{10}$/.test(ph)){alert("Invalid phone");return}
 const a=custAddress.value.trim();
 if(a.length<15||a.length>100){alert("Please enter a complete delivery address (minimum 15 characters)");return}
 if(!mapLink){alert("Location required");return}

 let txt=`20nagar Food Xpress\nRestaurant: ${currentRestaurant}\n\nItems:\n`;
 for(const i in cart){
  const p=price(i);
  txt+=`${i} × ${cart[i]} = ₹${cart[i]*p}\n`
 }
 const d=delivery(t);
 txt+=`\nItem Total: ₹${t}\nDelivery: ₹${d}\nTotal: ₹${t+d}\n\n`;
 txt+=`${n}\n${ph}\n${a}\n${mapLink}`;
 navigator.clipboard.writeText(txt);
 window.location.href="https://wa.me/919484818194?text="+encodeURIComponent(txt)
}

renderRestaurants();
</script>
</body>
</html>
