<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>20nagar Food Xpress</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--brand:#ff9933}
body{margin:0;font-family:Arial,sans-serif;background:#f7f7f7}
.page{display:none;min-height:100vh;background:#fff}
.page.active{display:block}
.header{padding:10px;border-bottom:1px solid #ddd;text-align:center}
.header h1{margin:0;font-size:18px}
.topbar{padding:12px;border-bottom:1px solid #ddd;cursor:pointer}
.content{padding:14px;padding-bottom:90px}
h2{text-align:center;margin-top:0}

.search{width:100%;padding:10px;margin:10px 0}
.restaurant{padding:12px;border:1px solid #ddd;margin-bottom:10px;cursor:pointer}

.category{font-weight:bold;font-size:18px;margin-top:20px}

.item,.cart-item{display:flex;justify-content:space-between;align-items:flex-start;padding:10px 0;border-bottom:1px solid #eee}
.item-name{font-weight:600}
.item-desc{font-size:13px;color:#777;margin-top:2px}

.qty{display:flex;align-items:center;gap:8px}
.qty button{width:28px;height:28px;border:none;background:var(--brand);color:#fff;font-size:18px}

.cart-bar{position:fixed;bottom:0;left:0;right:0;background:var(--brand);color:#fff;padding:12px;display:none;justify-content:space-between;cursor:pointer}

.bill{margin-top:12px}
.bill div{display:flex;justify-content:space-between;margin-bottom:6px}
.bill .total{font-weight:bold;font-size:18px}

.note{font-size:12px;color:#666;margin-top:8px}

button.primary{width:100%;padding:12px;background:var(--brand);color:#fff;border:none;font-size:16px;margin-top:16px}

.cat-btn{position:fixed;right:16px;bottom:80px;background:#333;color:#fff;padding:10px 14px;border-radius:20px;font-size:14px;cursor:pointer}

.cat-popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none}
.cat-box{background:#fff;margin:20% auto;width:80%;border-radius:8px;padding:10px}
.cat-box div{padding:10px;border-bottom:1px solid #eee;cursor:pointer}

input,textarea{width:100%;padding:10px;margin-top:6px;font-size:16px}
.small{font-size:12px;color:#666}
</style>
</head>
<body>

<!-- PAGE 1 -->
<div id="page-restaurants" class="page active">
  <div class="header"><h1>20nagar Food Xpress</h1></div>
  <div class="content">
    <h2>Select Restaurant</h2>
    <input class="search" placeholder="Search restaurant..." oninput="filterRestaurants(this.value)">
    <div id="restaurantList"></div>
  </div>
</div>

<!-- PAGE 2 -->
<div id="page-menu" class="page">
  <div class="topbar" onclick="backToRestaurants()">← Back</div>
  <div class="header"><h1>20nagar Food Xpress</h1></div>
  <div class="content">
    <h2 id="menuTitle"></h2>
    <div id="menuItems"></div>
  </div>
  <div class="cat-btn" onclick="openCats()">☰ Categories</div>
</div>

<div id="catPopup" class="cat-popup" onclick="closeCats()">
  <div class="cat-box" onclick="event.stopPropagation()" id="catList"></div>
</div>

<!-- PAGE 3 -->
<div id="page-summary" class="page">
  <div class="topbar" onclick="goBack()">← Back</div>
  <div class="header"><h1>20nagar Food Xpress</h1></div>
  <div class="content">
    <h2>Order Summary</h2>
    <div id="summaryItems"></div>

    <div class="bill">
      <div><span>Item Total</span><span id="itemTotal">₹0</span></div>
      <div><span>Delivery Charge</span><span id="deliveryCharge">₹0</span></div>
      <div class="total"><span>Total Payable</span><span id="grandTotal">₹0</span></div>
    </div>

    <div class="note">
      Delivery charges shown are applicable up to 2.5 km.
      Charges may vary for longer distances.
    </div>

    <button class="primary" onclick="goToAddress()">Continue → Address</button>
  </div>
</div>

<!-- PAGE 4 -->
<div id="page-address" class="page">
  <div class="topbar" onclick="goBack()">← Back</div>
  <div class="header"><h1>20nagar Food Xpress</h1></div>
  <div class="content">
    <h2>Delivery Details</h2>
    <label>Name</label><input id="custName">
    <label>Phone</label><input id="custPhone">
    <label>Address</label><textarea id="custAddress"></textarea>
    <button class="primary" onclick="captureLocation()">Use my current location</button>
    <p id="locStatus" class="small"></p>
    <button class="primary" onclick="placeOrder()">Place Order</button>
  </div>
</div>

<div id="cartBar" class="cart-bar" onclick="openSummary()">
  <span id="cartInfo"></span><span>View Order →</span>
</div>

<script>
const restaurants=[{name:"Hotel Anand"},{name:"Shree Krishna Dhaba"}];

const menus={
  "Hotel Anand":{
    Veg:[{n:"Paneer Butter Masala",p:180,d:"Rich tomato gravy with butter and cream"}],
    "Non-Veg":[{n:"Chicken Biryani",p:220,d:"Slow cooked rice with spices"}]
  },
  "Shree Krishna Dhaba":{
    Veg:[{n:"Veg Kolhapuri",p:160}],
    "Non-Veg":[{n:"Chicken Curry",p:200,d:"Traditional spicy gravy"}]
  }
};

let cart={},currentRestaurant="",stack=["page-restaurants"];
let lat="",lng="",mapLink="";

/* DELIVERY CALCULATION (≤2.5 km) */
function getDeliveryCharge(itemTotal){
  if(itemTotal>=1199) return 1;
  if(itemTotal>=999) return 9;
  if(itemTotal>=799) return 19;
  if(itemTotal>=599) return 29;
  if(itemTotal>=399) return 39;
  return 49;
}

/* NAV */
function show(p){document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));document.getElementById(p).classList.add("active")}
function nav(p){stack.push(p);show(p)}
function goBack(){stack.pop();show(stack[stack.length-1])}
function backToRestaurants(){cart={};updateBar();stack=["page-restaurants"];show("page-restaurants")}

/* RESTAURANTS */
function renderRestaurants(){
  restaurantList.innerHTML="";
  restaurants.forEach(r=>{
    const d=document.createElement("div");
    d.className="restaurant";
    d.innerText=r.name;
    d.onclick=()=>openMenu(r.name);
    restaurantList.appendChild(d);
  });
}
function filterRestaurants(q){
  q=q.toLowerCase();
  document.querySelectorAll(".restaurant").forEach(r=>r.style.display=r.innerText.toLowerCase().includes(q)?"":"none");
}

/* MENU */
function openMenu(name){
  cart={};currentRestaurant=name;
  menuTitle.innerText=name;
  renderMenu();
  nav("page-menu");
}
function renderMenu(){
  menuItems.innerHTML="";catList.innerHTML="";
  const m=menus[currentRestaurant];
  for(const c in m){
    menuItems.innerHTML+=`<div class="category" id="cat-${c}">${c}</div>`;
    catList.innerHTML+=`<div onclick="scrollCat('${c}')">${c}</div>`;
    m[c].forEach(i=>{
      const q=cart[i.n]||0;
      menuItems.innerHTML+=`
      <div class="item">
        <div>
          <div class="item-name">${i.n}</div>
          ${i.d?`<div class="item-desc">${i.d}</div>`:""}
          <div class="small">₹${i.p}</div>
        </div>
        <div class="qty">
          <button onclick="upd('${i.n}',${i.p},-1)">−</button>
          <span>${q}</span>
          <button onclick="upd('${i.n}',${i.p},1)">+</button>
        </div>
      </div>`;
    });
  }
  updateBar();
}

/* CATEGORY */
function openCats(){catPopup.style.display="block"}
function closeCats(){catPopup.style.display="none"}
function scrollCat(c){
  document.getElementById("cat-"+c).scrollIntoView({behavior:"smooth"});
  closeCats();
}

/* CART */
function upd(n,p,d){
  cart[n]=(cart[n]||0)+d;
  if(cart[n]<=0)delete cart[n];
  if(stack[stack.length-1]==="page-menu")renderMenu();
  if(stack[stack.length-1]==="page-summary")renderSummary();
}
function updateBar(){
  let it=0,t=0;
  for(const i in cart){it+=cart[i];t+=cart[i]*getPrice(i);}
  if(it>0 && stack[stack.length-1]==="page-menu"){
    cartBar.style.display="flex";
    cartInfo.innerText=`${it} items | ₹${t}`;
  } else cartBar.style.display="none";
}
function openSummary(){renderSummary();nav("page-summary")}
function renderSummary(){
  summaryItems.innerHTML="";
  let itemTotal=0;
  for(const i in cart){
    const p=getPrice(i);
    itemTotal+=cart[i]*p;
    summaryItems.innerHTML+=`
    <div class="cart-item">
      <div>${i}<div class="small">₹${p}</div></div>
      <div class="qty">
        <button onclick="upd('${i}',${p},-1)">−</button>
        <span>${cart[i]}</span>
        <button onclick="upd('${i}',${p},1)">+</button>
      </div>
    </div>`;
  }

  const dc=getDeliveryCharge(itemTotal);
  itemTotalEl.innerText=`₹${itemTotal}`;
  deliveryCharge.innerText=`₹${dc}`;
  grandTotal.innerText=`₹${itemTotal+dc}`;
}

/* ADDRESS */
function goToAddress(){nav("page-address")}
function captureLocation(){
  navigator.geolocation.getCurrentPosition(p=>{
    lat=p.coords.latitude;lng=p.coords.longitude;
    mapLink=`https://www.google.com/maps?q=${lat},${lng}`;
    locStatus.innerText="Location captured ✓";
  },()=>alert("Location permission required"));
}

/* PLACE ORDER */
function placeOrder(){
  const name=custName.value.trim();
  if(!/^[A-Za-z ]{5,25}$/.test(name)){alert("Name must be 5–25 letters only.");return;}
  const phone=custPhone.value.trim();
  if(!/^[0-9]{10}$/.test(phone)){alert("Phone must be exactly 10 digits.");return;}
  const address=custAddress.value.trim();
  if(address.length<15||address.length>100){alert("Address must be 15–100 characters.");return;}
  if(!mapLink){alert("Please capture location.");return;}

  let itemTotal=0;
  let text=`20nagar Food Xpress\nRestaurant: ${currentRestaurant}\n\nItems:\n`;
  for(const i in cart){
    const p=getPrice(i);
    itemTotal+=cart[i]*p;
    text+=`${i} × ${cart[i]} = ₹${cart[i]*p}\n`;
  }
  const dc=getDeliveryCharge(itemTotal);
  text+=`\nItem Total: ₹${itemTotal}\nDelivery Charge: ₹${dc}\nTotal Payable: ₹${itemTotal+dc}\n\n`;
  text+=`Customer:\n${name}\n${phone}\n${address}\nLocation:\n${mapLink}`;

  navigator.clipboard.writeText(text);
  window.location.href="https://wa.me/919484818194?text="+encodeURIComponent(text);
}

function getPrice(n){
  return Object.values(menus[currentRestaurant]).flat().find(x=>x.n===n).p;
}

renderRestaurants();
</script>
</body>
</html>
